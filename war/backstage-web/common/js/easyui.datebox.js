/*
 * calendar,datebox,datetimebox
*/
;(function(e){function t(t){var n=e.data(t,"calendar").options,r=e(t);if(n.fit==1){var i=r.parent();n.width=i.width(),n.height=i.height()}var s=r.find(".calendar-header");r._outerWidth(n.width),r._outerHeight(n.height),r.find(".calendar-body")._outerHeight(r.height()-s._outerHeight())}function n(n){e(n).addClass("calendar").html('<div class="calendar-header"><div class="calendar-prevmonth"></div><div class="calendar-nextmonth"></div><div class="calendar-prevyear"></div><div class="calendar-nextyear"></div><div class="calendar-title"><span>Aprial 2010</span></div></div><div class="calendar-body"><div class="calendar-menu"><div class="calendar-menu-year-inner"><span class="calendar-menu-prev"></span><span><input class="calendar-menu-year" type="text"></input></span><span class="calendar-menu-next"></span></div><div class="calendar-menu-month-inner"></div></div></div>'),e(n).find(".calendar-title span").hover(function(){e(this).addClass("calendar-menu-hover")},function(){e(this).removeClass("calendar-menu-hover")}).click(function(){var t=e(n).find(".calendar-menu");t.is(":visible")?t.hide():s(n)}),e(".calendar-prevmonth,.calendar-nextmonth,.calendar-prevyear,.calendar-nextyear",n).hover(function(){e(this).addClass("calendar-nav-hover")},function(){e(this).removeClass("calendar-nav-hover")}),e(n).find(".calendar-nextmonth").click(function(){r(n,1)}),e(n).find(".calendar-prevmonth").click(function(){r(n,-1)}),e(n).find(".calendar-nextyear").click(function(){i(n,1)}),e(n).find(".calendar-prevyear").click(function(){i(n,-1)}),e(n).bind("_resize",function(){var r=e.data(n,"calendar").options;return r.fit==1&&t(n),!1})}function r(t,n){var r=e.data(t,"calendar").options;r.month+=n,r.month>12?(r.year++,r.month=1):r.month<1&&(r.year--,r.month=12),u(t);var i=e(t).find(".calendar-menu-month-inner");i.find("td.calendar-selected").removeClass("calendar-selected"),i.find("td:eq("+(r.month-1)+")").addClass("calendar-selected")}function i(t,n){var r=e.data(t,"calendar").options;r.year+=n,u(t);var i=e(t).find(".calendar-menu-year");i.val(r.year)}function s(t){function f(){var r=e(t).find(".calendar-menu"),i=r.find(".calendar-menu-year").val(),s=r.find(".calendar-selected").attr("abbr");isNaN(i)||(n.year=parseInt(i),n.month=parseInt(s),u(t)),r.hide()}var n=e.data(t,"calendar").options;e(t).find(".calendar-menu").show();if(e(t).find(".calendar-menu-month-inner").is(":empty")){e(t).find(".calendar-menu-month-inner").empty();var r=e("<table></table>").appendTo(e(t).find(".calendar-menu-month-inner")),i=0;for(var s=0;s<3;s++){var o=e("<tr></tr>").appendTo(r);for(var a=0;a<4;a++)e('<td class="calendar-menu-month"></td>').html(n.months[i++]).attr("abbr",i).appendTo(o)}e(t).find(".calendar-menu-prev,.calendar-menu-next").hover(function(){e(this).addClass("calendar-menu-hover")},function(){e(this).removeClass("calendar-menu-hover")}),e(t).find(".calendar-menu-next").click(function(){var n=e(t).find(".calendar-menu-year");isNaN(n.val())||n.val(parseInt(n.val())+1)}),e(t).find(".calendar-menu-prev").click(function(){var n=e(t).find(".calendar-menu-year");isNaN(n.val())||n.val(parseInt(n.val()-1))}),e(t).find(".calendar-menu-year").keypress(function(e){e.keyCode==13&&f()}),e(t).find(".calendar-menu-month").hover(function(){e(this).addClass("calendar-menu-hover")},function(){e(this).removeClass("calendar-menu-hover")}).click(function(){var n=e(t).find(".calendar-menu");n.find(".calendar-selected").removeClass("calendar-selected"),e(this).addClass("calendar-selected"),f()})}var l=e(t).find(".calendar-body"),c=e(t).find(".calendar-menu"),h=c.find(".calendar-menu-year-inner"),p=c.find(".calendar-menu-month-inner");h.find("input").val(n.year).focus(),p.find("td.calendar-selected").removeClass("calendar-selected"),p.find("td:eq("+(n.month-1)+")").addClass("calendar-selected"),c._outerWidth(l._outerWidth()),c._outerHeight(l._outerHeight()),p._outerHeight(c.height()-h._outerHeight())}function o(t,n,r){var i=e.data(t,"calendar").options,s=[],o=(new Date(n,r,0)).getDate();for(var u=1;u<=o;u++)s.push([n,r,u]);var a=[],f=[],l=-1;while(s.length>0){var c=s.shift();f.push(c);var h=(new Date(c[0],c[1]-1,c[2])).getDay();l==h?h=0:h==(i.firstDay==0?7:i.firstDay)-1&&(a.push(f),f=[]),l=h}f.length&&a.push(f);var p=a[0];if(p.length<7)while(p.length<7){var d=p[0],c=new Date(d[0],d[1]-1,d[2]-1);p.unshift([c.getFullYear(),c.getMonth()+1,c.getDate()])}else{var d=p[0],f=[];for(var u=1;u<=7;u++){var c=new Date(d[0],d[1]-1,d[2]-u);f.unshift([c.getFullYear(),c.getMonth()+1,c.getDate()])}a.unshift(f)}var v=a[a.length-1];while(v.length<7){var m=v[v.length-1],c=new Date(m[0],m[1]-1,m[2]+1);v.push([c.getFullYear(),c.getMonth()+1,c.getDate()])}if(a.length<6){var m=v[v.length-1],f=[];for(var u=1;u<=7;u++){var c=new Date(m[0],m[1]-1,m[2]+u);f.push([c.getFullYear(),c.getMonth()+1,c.getDate()])}a.push(f)}return a}function u(t){var n=e.data(t,"calendar").options;e(t).find(".calendar-title span").html(n.months[n.month-1]+" "+n.year);var r=e(t).find("div.calendar-body");r.find(">table").remove();var i=e('<table cellspacing="0" cellpadding="0" border="0"><thead></thead><tbody></tbody></table>').prependTo(r),s=e("<tr></tr>").appendTo(i.find("thead"));for(var u=n.firstDay;u<n.weeks.length;u++)s.append("<th>"+n.weeks[u]+"</th>");for(var u=0;u<n.firstDay;u++)s.append("<th>"+n.weeks[u]+"</th>");var a=o(t,n.year,n.month);for(var u=0;u<a.length;u++){var f=a[u],s=e("<tr></tr>").appendTo(i.find("tbody"));for(var l=0;l<f.length;l++){var c=f[l];e('<td class="calendar-day calendar-other-month"></td>').attr("abbr",c[0]+","+c[1]+","+c[2]).html(c[2]).appendTo(s)}}i.find('td[abbr^="'+n.year+","+n.month+'"]').removeClass("calendar-other-month");var h=new Date,p=h.getFullYear()+","+(h.getMonth()+1)+","+h.getDate();i.find('td[abbr="'+p+'"]').addClass("calendar-today");if(n.current){i.find(".calendar-selected").removeClass("calendar-selected");var d=n.current.getFullYear()+","+(n.current.getMonth()+1)+","+n.current.getDate();i.find('td[abbr="'+d+'"]').addClass("calendar-selected")}var v=6-n.firstDay,m=v+1;v>=7&&(v-=7),m>=7&&(m-=7),i.find("tr").find("td:eq("+v+")").addClass("calendar-saturday"),i.find("tr").find("td:eq("+m+")").addClass("calendar-sunday"),i.find("td").hover(function(){e(this).addClass("calendar-hover")},function(){e(this).removeClass("calendar-hover")}).click(function(){i.find(".calendar-selected").removeClass("calendar-selected"),e(this).addClass("calendar-selected");var r=e(this).attr("abbr").split(",");n.current=new Date(r[0],parseInt(r[1])-1,r[2]),n.onSelect.call(t,n.current)})}e.fn.calendar=function(r,i){return typeof r=="string"?e.fn.calendar.methods[r](this,i):(r=r||{},this.each(function(){var i=e.data(this,"calendar");i?e.extend(i.options,r):(i=e.data(this,"calendar",{options:e.extend({},e.fn.calendar.defaults,e.fn.calendar.parseOptions(this),r)}),n(this)),i.options.border==0&&e(this).addClass("calendar-noborder"),t(this),u(this),e(this).find("div.calendar-menu").hide()}))},e.fn.calendar.methods={options:function(t){return e.data(t[0],"calendar").options},resize:function(e){return e.each(function(){t(this)})},moveTo:function(t,n){return t.each(function(){e(this).calendar({year:n.getFullYear(),month:n.getMonth()+1,current:n})})}},e.fn.calendar.parseOptions=function(t){var n=e(t);return e.extend({},e.parser.parseOptions(t,["width","height",{firstDay:"number",fit:"boolean",border:"boolean"}]))},e.fn.calendar.defaults={width:180,height:180,fit:!1,border:!0,firstDay:0,weeks:["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],months:["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],year:(new Date).getFullYear(),month:(new Date).getMonth()+1,current:new Date,onSelect:function(e){}}})(jQuery);
;(function(e){function t(t){function s(){var s=e(t).combo("panel");n.calendar=e("<div></div>").appendTo(s).wrap('<div class="datebox-calendar-inner"></div>'),n.calendar.calendar({fit:!0,border:!1,onSelect:function(n){var s=r.formatter(n);i(t,s),e(t).combo("hidePanel"),r.onSelect.call(t,n)}}),i(t,r.value);var o=e('<div class="datebox-button"></div>').appendTo(s);e('<a href="javascript:void(0)" class="datebox-current"></a>').html(r.currentText).appendTo(o),e('<a href="javascript:void(0)" class="datebox-close"></a>').html(r.closeText).appendTo(o),o.find(".datebox-current,.datebox-close").hover(function(){e(this).addClass("datebox-button-hover")},function(){e(this).removeClass("datebox-button-hover")}),o.find(".datebox-current").click(function(){n.calendar.calendar({year:(new Date).getFullYear(),month:(new Date).getMonth()+1,current:new Date})}),o.find(".datebox-close").click(function(){e(t).combo("hidePanel")})}var n=e.data(t,"datebox"),r=n.options;e(t).addClass("datebox-f"),e(t).combo(e.extend({},r,{onShowPanel:function(){n.calendar.calendar("resize"),r.onShowPanel.call(t)}})),e(t).combo("textbox").parent().addClass("datebox"),n.calendar||s()}function n(e,t){i(e,t)}function r(t){var n=e.data(t,"datebox").options,r=e.data(t,"datebox").calendar,s=n.formatter(r.calendar("options").current);i(t,s),e(t).combo("hidePanel")}function i(t,n){var r=e.data(t,"datebox"),i=r.options;e(t).combo("setValue",n).combo("setText",n),r.calendar.calendar("moveTo",i.parser(n))}e.fn.datebox=function(n,r){if(typeof n=="string"){var i=e.fn.datebox.methods[n];return i?i(this,r):this.combo(n,r)}return n=n||{},this.each(function(){var r=e.data(this,"datebox");r?e.extend(r.options,n):e.data(this,"datebox",{options:e.extend({},e.fn.datebox.defaults,e.fn.datebox.parseOptions(this),n)}),t(this)})},e.fn.datebox.methods={options:function(t){var n=t.combo("options");return e.extend(e.data(t[0],"datebox").options,{originalValue:n.originalValue,disabled:n.disabled,readonly:n.readonly})},calendar:function(t){return e.data(t[0],"datebox").calendar},setValue:function(e,t){return e.each(function(){i(this,t)})},reset:function(t){return t.each(function(){var t=e(this).datebox("options");e(this).datebox("setValue",t.originalValue)})}},e.fn.datebox.parseOptions=function(t){var n=e(t);return e.extend({},e.fn.combo.parseOptions(t),{})},e.fn.datebox.defaults=e.extend({},e.fn.combo.defaults,{panelWidth:180,panelHeight:"auto",keyHandler:{up:function(){},down:function(){},enter:function(){r(this)},query:function(e){n(this,e)}},currentText:"\u4ECA\u5929",closeText:"\u5173\u95ED",okText:"\u786e\u5b9a",formatter:function(e){var t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return n+"/"+r+"/"+t},parser:function(e){var t=Date.parse(e);return isNaN(t)?new Date:new Date(t)},onSelect:function(e){}})})(jQuery);
;(function(e){function t(t){var r=e.data(t,"timespinner").options;e(t).addClass("timespinner-f"),e(t).spinner(r),e(t).unbind(".timespinner"),e(t).bind("click.timespinner",function(){var e=0;if(this.selectionStart!=null)e=this.selectionStart;else if(this.createTextRange){var i=t.createTextRange(),s=document.selection.createRange();s.setEndPoint("StartToStart",i),e=s.text.length}e>=0&&e<=2?r.highlight=0:e>=3&&e<=5?r.highlight=1:e>=6&&e<=8&&(r.highlight=2),n(t)}).bind("blur.timespinner",function(){i(t)})}function n(t){var n=e.data(t,"timespinner").options,r=0,i=0;n.highlight==0?(r=0,i=2):n.highlight==1?(r=3,i=5):n.highlight==2&&(r=6,i=8);if(t.selectionStart!=null)t.setSelectionRange(r,i);else if(t.createTextRange){var s=t.createTextRange();s.collapse(),s.moveEnd("character",i),s.moveStart("character",r),s.select()}e(t).focus()}function r(t,n){var r=e.data(t,"timespinner").options;if(!n)return null;var i=n.split(r.separator);for(var s=0;s<i.length;s++)if(isNaN(i[s]))return null;while(i.length<3)i.push(0);return new Date(1900,0,0,i[0],i[1],i[2])}function i(t){function l(e){return(e<10?"0":"")+e}var n=e.data(t,"timespinner").options,i=e(t).val(),s=r(t,i);s||(s=r(t,n.value));if(!s){n.value="",e(t).val("");return}var o=r(t,n.min),u=r(t,n.max);o&&o>s&&(s=o),u&&u<s&&(s=u);var a=[l(s.getHours()),l(s.getMinutes())];n.showSeconds&&a.push(l(s.getSeconds()));var f=a.join(n.separator);n.value=f,e(t).val(f)}function s(t,r){var s=e.data(t,"timespinner").options,o=e(t).val();o==""&&(o=[0,0,0].join(s.separator));var u=o.split(s.separator);for(var a=0;a<u.length;a++)u[a]=parseInt(u[a],10);r==1?u[s.highlight]-=s.increment:u[s.highlight]+=s.increment,e(t).val(u.join(s.separator)),i(t),n(t)}e.fn.timespinner=function(n,r){if(typeof n=="string"){var i=e.fn.timespinner.methods[n];return i?i(this,r):this.spinner(n,r)}return n=n||{},this.each(function(){var r=e.data(this,"timespinner");r?e.extend(r.options,n):(e.data(this,"timespinner",{options:e.extend({},e.fn.timespinner.defaults,e.fn.timespinner.parseOptions(this),n)}),t(this))})},e.fn.timespinner.methods={options:function(t){var n=e.data(t[0],"timespinner").options;return e.extend(n,{value:t.val(),originalValue:t.spinner("options").originalValue})},setValue:function(t,n){return t.each(function(){e(this).val(n),i(this)})},getHours:function(t){var n=e.data(t[0],"timespinner").options,r=t.val().split(n.separator);return parseInt(r[0],10)},getMinutes:function(t){var n=e.data(t[0],"timespinner").options,r=t.val().split(n.separator);return parseInt(r[1],10)},getSeconds:function(t){var n=e.data(t[0],"timespinner").options,r=t.val().split(n.separator);return parseInt(r[2],10)||0}},e.fn.timespinner.parseOptions=function(t){return e.extend({},e.fn.spinner.parseOptions(t),e.parser.parseOptions(t,["separator",{showSeconds:"boolean",highlight:"number"}]))},e.fn.timespinner.defaults=e.extend({},e.fn.spinner.defaults,{separator:":",showSeconds:!1,highlight:0,spin:function(e){s(this,e)}})})(jQuery);
;(function(e){function t(t){var n=e.data(t,"datetimebox"),r=n.options;e(t).datebox(e.extend({},r,{onShowPanel:function(){var n=e(t).datetimebox("getValue");s(t,n,!0),r.onShowPanel.call(t)},formatter:e.fn.datebox.defaults.formatter,parser:e.fn.datebox.defaults.parser})),e(t).removeClass("datebox-f").addClass("datetimebox-f"),e(t).datebox("calendar").calendar({onSelect:function(e){r.onSelect.call(t,e)}});var o=e(t).datebox("panel");if(!n.spinner){var u=e('<div style="padding:2px"><input style="width:80px"></div>').insertAfter(o.children("div.datebox-calendar-inner"));n.spinner=u.children("input");var a=o.children("div.datebox-button"),f=e('<a href="javascript:void(0)" class="datebox-ok"></a>').html(r.okText).appendTo(a);f.hover(function(){e(this).addClass("datebox-button-hover")},function(){e(this).removeClass("datebox-button-hover")}).click(function(){i(t)})}n.spinner.timespinner({showSeconds:r.showSeconds,separator:r.timeSeparator}).unbind(".datetimebox").bind("mousedown.datetimebox",function(e){e.stopPropagation()}),s(t,r.value)}function n(t){var n=e(t).datetimebox("calendar"),r=e(t).datetimebox("spinner"),i=n.calendar("options").current;return new Date(i.getFullYear(),i.getMonth(),i.getDate(),r.timespinner("getHours"),r.timespinner("getMinutes"),r.timespinner("getSeconds"))}function r(e,t){s(e,t,!0)}function i(t){var r=e.data(t,"datetimebox").options,i=n(t);s(t,r.formatter.call(t,i)),e(t).combo("hidePanel")}function s(t,n,r){function o(n){function r(e){return(e<10?"0":"")+e}var s=[r(n.getHours()),r(n.getMinutes())];return i.showSeconds&&s.push(r(n.getSeconds())),s.join(e(t).datetimebox("spinner").timespinner("options").separator)}var i=e.data(t,"datetimebox").options;e(t).combo("setValue",n);if(!r)if(n){var s=i.parser.call(t,n);e(t).combo("setValue",i.formatter.call(t,s)),e(t).combo("setText",i.formatter.call(t,s))}else e(t).combo("setText",n);var s=i.parser.call(t,n);e(t).datetimebox("calendar").calendar("moveTo",s),e(t).datetimebox("spinner").timespinner("setValue",o(s))}e.fn.datetimebox=function(n,r){if(typeof n=="string"){var i=e.fn.datetimebox.methods[n];return i?i(this,r):this.datebox(n,r)}return n=n||{},this.each(function(){var r=e.data(this,"datetimebox");r?e.extend(r.options,n):e.data(this,"datetimebox",{options:e.extend({},e.fn.datetimebox.defaults,e.fn.datetimebox.parseOptions(this),n)}),t(this)})},e.fn.datetimebox.methods={options:function(t){var n=t.datebox("options");return e.extend(e.data(t[0],"datetimebox").options,{originalValue:n.originalValue,disabled:n.disabled,readonly:n.readonly})},spinner:function(t){return e.data(t[0],"datetimebox").spinner},setValue:function(e,t){return e.each(function(){s(this,t)})},reset:function(t){return t.each(function(){var t=e(this).datetimebox("options");e(this).datetimebox("setValue",t.originalValue)})}},e.fn.datetimebox.parseOptions=function(t){var n=e(t);return e.extend({},e.fn.datebox.parseOptions(t),e.parser.parseOptions(t,["timeSeparator",{showSeconds:"boolean"}]))},e.fn.datetimebox.defaults=e.extend({},e.fn.datebox.defaults,{showSeconds:!0,timeSeparator:":",keyHandler:{up:function(){},down:function(){},enter:function(){i(this)},query:function(e){r(this,e)}},formatter:function(t){function s(e){return(e<10?"0":"")+e}var n=t.getHours(),r=t.getMinutes(),i=t.getSeconds(),o=e(this).datetimebox("spinner").timespinner("options").separator,u=e.fn.datebox.defaults.formatter(t)+" "+s(n)+o+s(r);return e(this).datetimebox("options").showSeconds&&(u+=o+s(i)),u},parser:function(t){if(e.trim(t)=="")return new Date;var n=t.split(" "),r=e.fn.datebox.defaults.parser(n[0]);if(n.length<2)return r;var i=e(this).datetimebox("spinner").timespinner("options").separator,s=n[1].split(i),o=parseInt(s[0],10)||0,u=parseInt(s[1],10)||0,a=parseInt(s[2],10)||0;return new Date(r.getFullYear(),r.getMonth(),r.getDate(),o,u,a)}})})(jQuery);
/*日期格式*/
$.fn.datebox.defaults.formatter = function(date){
	var y = date.getFullYear();
	var m = date.getMonth()+1;
	var d = date.getDate();
	return y+'-'+m+'-'+d;
}
$.fn.datebox.defaults.parser = function(s){
	if (!s) return new Date();
	var ss = (s.split(/[\-\\\/]/g));
	var y = parseInt(ss[0],10);
	var m = parseInt(ss[1],10);
	var d = parseInt(ss[2],10);
	if (!isNaN(y) && !isNaN(m) && !isNaN(d)){
		return new Date(y,m-1,d);
	} else {
		return new Date();
	}
}